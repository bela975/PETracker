<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanban Board</title>
  <link rel="stylesheet" type="text/css" href="{% static '/style.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <style>
    .content {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .column {
      width: 300px;
      background-color: #cfa5f7;
      border: 1px solid #000000;
      margin: 10px;
      padding: 10px;
      border-radius: 5px;
    }
    .column h2 {
      text-align: center;
    }
    .to-do-list-box {
      min-height: 150px;
      padding: 5px;
      background-color: #fff;
      border: 1px solid #000000;
      border-radius: 5px;
    }
    .task-item {
      background-color: #fff;
      border: 1px solid #000000;
      border-radius: 5px;
      padding: 5px;
      margin: 5px 0;
      cursor: pointer;
    }
    .task-item:hover {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>

  <div class="navbar">
    <a class="active" href="/home/"><i class="fa fa-fw fa-home"></i> Home</a>
    <a href="/calendar/"><i class="fa fa-fw fa-calendar"></i> Calendar</a>
    <a href="/kanban/"><i class="fa fa-fw fa-table"></i>Checklist</a>
    <a href="/login/"><i class="fa fa-fw fa-user"></i> Login</a>
</div>
<div class="title">
    <a>PETracker</a>
</div>

  <div class="content">
    <div class="column" id="to-do-column" ondrop="drop(event, 'to-do')" ondragover="allowDrop(event)">
      <h2>To Do</h2>
      <form>
        <input type="text" name="task" id="task" placeholder="Nova Tarefa..." />
        <input type="text" name="responsible" id="responsible" placeholder="Responsável" />
        <input type="date" name="due-date" id="due-date" placeholder="Data de vencimento " />
        <input type="button" name="" value="Add task" onclick="addTask();" />
      </form>
      <div class="to-do-list-box">
        <ul id="to-do-list" ondragstart="drag(event)" class="task-list">
        </ul>
      </div>
    </div>
    <div class="column" id="in-progress-column" ondrop="drop(event, 'in-progress')" ondragover="allowDrop(event)">
      <h2>In Progress</h2>
      <div class="to-do-list-box">
        <ul id="in-progress-list" ondragstart="drag(event)" class="task-list">
        </ul>
      </div>
    </div>
    <div class="column" id="done-column" ondrop="drop(event, 'done')" ondragover="allowDrop(event)">
      <h2>Done</h2>
      <div class="to-do-list-box">
        <ul id="done-list" ondragstart="drag(event)" class="task-list">
        </ul>
      </div>
    </div> 
   <div class="column" id="history-column" ondrop="drop(event, 'history')" ondragover="allowDrop(event)">
      <h2>History</h2>
        <ul id="history-list" ondragstart="drag(event)" class="task-list">
        </ul>
      </div>
    </div>
  </div> 
<script type="text/javascript">
    var toDoList = document.getElementById("to-do-list");
    var inProgressList = document.getElementById("in-progress-list");
    var doneList = document.getElementById("done-list");
    var historyList = document.getElementById("history-list");
    var li;
    var itemId;
    var item;

  function addTask() {
  let taskName = document.getElementById("task").value;
  let responsible = document.getElementById("responsible").value;
  let dueDate = document.getElementById("due-date").value;
  
  if (taskName !== "") {
    itemId = Date.now();
    li = createTaskEl(taskName, itemId, responsible, dueDate);
    li.draggable = true;
    toDoList.appendChild(li);
    document.getElementById("task").value = "";
    document.getElementById("responsible").value = "";
    document.getElementById("due-date").value = "";
  }
}
  function createTaskEl(itemValue, itemId, responsible, dueDate) {
  let li = document.createElement("li");
  li.id = "task-" + itemId;
  li.setAttribute("data-id", itemId);
  li.setAttribute("draggable", "true");
  li.classList.add("task-item");
  li.appendChild(document.createTextNode(itemValue));

  if (responsible) {
    let divResponsible = document.createElement("div");
    divResponsible.classList.add("task-responsible");
    divResponsible.innerText = "Responsável: " + responsible;
    li.appendChild(divResponsible);
  }

  if (dueDate) {
    let divDueDate = document.createElement("div");
    divDueDate.classList.add("task-due-date");
    divDueDate.innerText = "Data de vencimento: " + dueDate;
    li.appendChild(divDueDate);
  }
  li.appendChild(createRemoveTaskBtn(itemId));
  return li;
}

function createRemoveTaskBtn(itemId) {
  let btn = document.createElement("button");
  btn.setAttribute("onclick", "removeTask(" + itemId + ")");
  btn.innerHTML = "X";
  return btn;
}

function removeTask(itemId) {
  var taskItem = document.getElementById("task-" + itemId);
  taskItem.remove();
}

function allowDrop(ev) {
    ev.preventDefault();
}

function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev, target) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("text");
    var taskItem = document.getElementById(data);
    var taskList = document.getElementById(target + "-list");
    taskList.appendChild(taskItem);
}
  function removeTask(itemId) {
  var taskItem = document.getElementById("task-" + itemId);
  var parentList = taskItem.parentNode;
  
  if (parentList === toDoList || parentList === inProgressList || parentList     === doneList) {
    var li = createTaskEl(taskItem.textContent, itemId, "", "");
    li.draggable = true;
    historyList.appendChild(li);
  }
  
  taskItem.remove();
}
function toggleHistory() {
  var historyList = document.getElementById("history-list");
  if (historyList.style.display === "none") {
    historyList.style.display = "block";
  } else {
    historyList.style.display = "none";
  }
}

var historyHeader = document.querySelector("#history-column h2");
historyHeader.addEventListener("click", toggleHistory);

</script>
</body>
</html>